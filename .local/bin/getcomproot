#!/bin/sh

# A helper script for LaTeX/groff files used by `compiler` and `opout`.
# The user can add the root file of a larger project as a comment as below:
# % root = mainfile.tex
# And the compiler script will run on that instead of the opened file.

file=$(readlink -f "$1")
dir=$(dirname "$file")

texroot="$(sed -n 's/^\s*%.*root\s*=\s*\(\S\+\).*/\1/p' "${1}")"
if [ -n "$texroot" ]; then
  # Prepend dir if texroot is relative (doesn't start with /)
  if [ "${texroot#/}" = "$texroot" ]; then
    texroot="$dir/$texroot"
  fi
  [ -f "${texroot}" ] && readlink -f "${texroot}" && exit 0
fi

exit 1
